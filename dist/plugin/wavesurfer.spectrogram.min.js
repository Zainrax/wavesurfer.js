/*!
 * wavesurfer.js spectrogram plugin 5.2.0 (2023-08-09)
 * https://wavesurfer-js.org
 * @license BSD-3-Clause
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("WaveSurfer",[],e):"object"==typeof exports?exports.WaveSurfer=e():(t.WaveSurfer=t.WaveSurfer||{},t.WaveSurfer.spectrogram=e())}(self,(()=>(()=>{"use strict";var t={325:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,r,n){switch(this.bufferSize=t,this.sampleRate=e,this.bandwidth=2/t*(e/2),this.sinTable=new Float32Array(t),this.cosTable=new Float32Array(t),this.windowValues=new Float32Array(t),this.reverseTable=new Uint32Array(t),this.peakBand=0,this.peak=0,r){case"bartlett":for(a=0;a<t;a++)this.windowValues[a]=2/(t-1)*((t-1)/2-Math.abs(a-(t-1)/2));break;case"bartlettHann":for(a=0;a<t;a++)this.windowValues[a]=.62-.48*Math.abs(a/(t-1)-.5)-.38*Math.cos(2*Math.PI*a/(t-1));break;case"blackman":for(n=n||.16,a=0;a<t;a++)this.windowValues[a]=(1-n)/2-.5*Math.cos(2*Math.PI*a/(t-1))+n/2*Math.cos(4*Math.PI*a/(t-1));break;case"cosine":for(a=0;a<t;a++)this.windowValues[a]=Math.cos(Math.PI*a/(t-1)-Math.PI/2);break;case"gauss":for(n=n||.25,a=0;a<t;a++)this.windowValues[a]=Math.pow(Math.E,-.5*Math.pow((a-(t-1)/2)/(n*(t-1)/2),2));break;case"hamming":for(a=0;a<t;a++)this.windowValues[a]=.54-.46*Math.cos(2*Math.PI*a/(t-1));break;case"hann":case void 0:for(a=0;a<t;a++)this.windowValues[a]=.5*(1-Math.cos(2*Math.PI*a/(t-1)));break;case"lanczoz":for(a=0;a<t;a++)this.windowValues[a]=Math.sin(Math.PI*(2*a/(t-1)-1))/(Math.PI*(2*a/(t-1)-1));break;case"rectangular":for(a=0;a<t;a++)this.windowValues[a]=1;break;case"triangular":for(a=0;a<t;a++)this.windowValues[a]=2/t*(t/2-Math.abs(a-(t-1)/2));break;default:throw Error("No such window function '"+r+"'")}var a,i=1,o=t>>1;for(;i<t;){for(a=0;a<i;a++)this.reverseTable[a+i]=this.reverseTable[a]+o;i<<=1,o>>=1}for(a=0;a<t;a++)this.sinTable[a]=Math.sin(-Math.PI/a),this.cosTable[a]=Math.cos(-Math.PI/a);this.calculateSpectrum=function(t){var e,r,n,a=this.bufferSize,i=this.cosTable,o=this.sinTable,s=this.reverseTable,l=new Float32Array(a),h=new Float32Array(a),c=2/this.bufferSize,u=Math.sqrt,f=new Float32Array(a/2),p=Math.floor(Math.log(a)/Math.LN2);if(Math.pow(2,p)!==a)throw"Invalid buffer size, must be a power of 2.";if(a!==t.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+a+" Buffer Size: "+t.length;for(var d,v,w,y,m,g,b,x,k=1,M=0;M<a;M++)l[M]=t[s[M]]*this.windowValues[s[M]],h[M]=0;for(;k<a;){d=i[k],v=o[k],w=1,y=0;for(var S=0;S<k;S++){for(M=S;M<a;)g=w*l[m=M+k]-y*h[m],b=w*h[m]+y*l[m],l[m]=l[M]-g,h[m]=h[M]-b,l[M]+=g,h[M]+=b,M+=k<<1;w=(x=w)*d-y*v,y=x*v+y*d}k<<=1}M=0;for(var E=a/2;M<E;M++)(n=c*u((e=l[M])*e+(r=h[M])*r))>this.peak&&(this.peakBand=M,this.peak=n),f[M]=n;return f}},t.exports=e.default},943:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,a=(n=r(325))&&n.__esModule?n:{default:n};function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function o(){o=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",h=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,a){var i=e&&e.prototype instanceof d?e:d,o=Object.create(i.prototype),s=new _(a||[]);return n(o,"_invoke",{value:M(t,r,s)}),o}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var p={};function d(){}function v(){}function w(){}var y={};c(y,s,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(P([])));g&&g!==e&&r.call(g,s)&&(y=g);var b=w.prototype=d.prototype=Object.create(y);function x(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function a(n,o,s,l){var h=f(t[n],t,o);if("throw"!==h.type){var c=h.arg,u=c.value;return u&&"object"==i(u)&&r.call(u,"__await")?e.resolve(u.__await).then((function(t){a("next",t,s,l)}),(function(t){a("throw",t,s,l)})):e.resolve(u).then((function(t){c.value=t,s(c)}),(function(t){return a("throw",t,s,l)}))}l(h.arg)}var o;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){a(t,r,e,n)}))}return o=o?o.then(n,n):n()}})}function M(t,e,r){var n="suspendedStart";return function(a,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw i;return F()}for(r.method=a,r.arg=i;;){var o=r.delegate;if(o){var s=S(o,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=f(t,e,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function S(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var a=f(n,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,p;var i=a.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:F}}function F(){return{value:void 0,done:!0}}return v.prototype=w,n(b,"constructor",{value:w,configurable:!0}),n(w,"constructor",{value:v,configurable:!0}),v.displayName=c(w,h,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,c(t,h,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},x(k.prototype),c(k.prototype,l,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,a,i){void 0===i&&(i=Promise);var o=new k(u(e,r,n,a),i);return t.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},x(b),c(b,h,"Generator"),c(b,s,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=P,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(L),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return o.type="throw",o.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),l=r.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),L(r),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;L(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:P(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},t}function s(t,e,r,n,a,i,o){try{var s=t[i](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,a)}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=n.key,o=void 0,o=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(a,"string"),"symbol"===i(o)?o:String(o)),n)}var a,o}var h=function(){function t(e,r){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.drawSpectrogram=function(){var t,e=(t=o().mark((function t(e){var r,a,i,s,l,h,c,u,f,p,d;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(isNaN(e[0][0])||(e=[e]),n.wrapper.style.height=n.height*e.length+"px",n.canvas.width=n.width,n.canvas.height=n.height*e.length,r=n.spectrCc){t.next=7;break}return t.abrupt("return");case 7:a=0;case 8:if(!(a<e.length)){t.next=22;break}for(i=e[a],s=i[0].length,l=i.length,h=new ImageData(l,s),c=0;c<l;c++)for(u=0;u<s;u++)f=n.colorMap[i[c][u]],p=4*((s-1-u)*l+c),h.data[p]=255*f[0],h.data[p+1]=255*f[1],h.data[p+2]=255*f[2],h.data[p+3]=255*f[3];return t.next=16,createImageBitmap(h);case 16:return d=t.sent,t.next=19,r.drawImage(d,0,0,l,s,0,0,n.width,n.height);case 19:a++,t.next=8;break;case 22:n.loadLabels(n.options.labelsBackground,"12px","12px","",n.options.labelsColor,n.options.labelsHzColor||n.options.labelsColor,"center","#specLabels",e.length),n.emit("ready");case 24:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){s(i,n,a,o,l,"next",t)}function l(t){s(i,n,a,o,l,"throw",t)}o(void 0)}))});return function(t){return e.apply(this,arguments)}}(),this.params=e,this.wavesurfer=r,this.util=r.util,this.frequenciesDataUrl=e.frequenciesDataUrl,this._onScroll=function(t){n.updateScroll(t)},this._onRender=function(){n.render()},this._onWrapperClick=function(t){n._wrapperClickHandler(t)},this._onReady=function(){var t=n.drawer=r.drawer;if(n.container="string"==typeof e.container?document.querySelector(e.container):e.container,!n.container)throw Error("No container for WaveSurfer spectrogram");if(e.colorMap){if(e.colorMap.length<256)throw new Error("Colormap must contain 256 elements");for(var a=0;a<e.colorMap.length;a++){if(4!==e.colorMap[a].length)throw new Error("ColorMap entries must contain 4 values")}n.colorMap=e.colorMap}else{n.colorMap=[];for(var i=0;i<256;i++){var o=(255-i)/256;n.colorMap.push([o,o,o,1])}}n.width=t.width,n.pixelRatio=n.params.pixelRatio||r.params.pixelRatio,n.fftSamples=n.params.fftSamples||r.params.fftSamples||512,n.height=n.fftSamples/2,n.noverlap=e.noverlap,n.windowFunc=e.windowFunc,n.alpha=e.alpha,n.createWrapper(),n.createCanvas(),n.render(),t.wrapper.addEventListener("scroll",n._onScroll),r.on("redraw",n._onRender)}}var e,r,n;return e=t,n=[{key:"create",value:function(e){return{name:"spectrogram",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,staticProps:{FFT:a.default},instance:t}}}],(r=[{key:"init",value:function(){this.wavesurfer.isReady?this._onReady():this.wavesurfer.once("ready",this._onReady)}},{key:"destroy",value:function(){this.unAll(),this.wavesurfer.un("ready",this._onReady),this.wavesurfer.un("redraw",this._onRender),this.drawer&&this.drawer.wrapper.removeEventListener("scroll",this._onScroll),this.wavesurfer=null,this.util=null,this.params=null,this.wrapper&&(this.wrapper.removeEventListener("click",this._onWrapperClick),this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null)}},{key:"createWrapper",value:function(){var t=this.container.querySelector("spectrogram");t&&this.container.removeChild(t);var e=this.wavesurfer.params;if(this.wrapper=document.createElement("spectrogram"),this.params.labels){var r=this.labelsEl=document.createElement("canvas");r.classList.add("spec-labels"),this.drawer.style(r,{left:0,position:"absolute",zIndex:9,height:"".concat(this.height/this.pixelRatio,"px"),width:"".concat(55/this.pixelRatio,"px")}),this.wrapper.appendChild(r),this.loadLabels("rgba(68,68,68,0.5)","12px","10px","","#fff","#f7f7f7","center","#specLabels")}this.drawer.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:"".concat(this.height/this.pixelRatio,"px")}),(e.fillParent||e.scrollParent)&&this.drawer.style(this.wrapper,{width:"100%",overflowX:"hidden",overflowY:"hidden"}),this.container.appendChild(this.wrapper),this.wrapper.addEventListener("click",this._onWrapperClick)}},{key:"_wrapperClickHandler",value:function(t){t.preventDefault();var e="offsetX"in t?t.offsetX:t.layerX;this.fireEvent("click",e/this.width||0)}},{key:"createCanvas",value:function(){var t=this.canvas=this.wrapper.appendChild(document.createElement("canvas"));this.spectrCc=t.getContext("2d"),this.util.style(t,{position:"absolute",zIndex:4})}},{key:"render",value:function(){this.updateCanvasStyle(),this.frequenciesDataUrl?this.loadFrequenciesData(this.frequenciesDataUrl):this.getFrequencies(this.drawSpectrogram)}},{key:"updateCanvasStyle",value:function(){var t=Math.round(this.width/this.pixelRatio)+"px";this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width=t}},{key:"getFrequencies",value:function(t){var e=this.fftSamples,r=this.buffer=this.wavesurfer.backend.buffer,n=r.getChannelData(0),i=r.length,o=r.sampleRate,s=[];if(r){var l=this.noverlap;if(!l){var h=r.length/this.canvas.width;l=Math.max(0,Math.round(e-h))}for(var c=new a.default(e,o,this.windowFunc,this.alpha),u=(Math.floor(i/(e-l)),0);u+e<n.length;){var f=n.slice(u,u+e),p=c.calculateSpectrum(f),d=new Uint8Array(e/2),v=void 0;for(v=0;v<e/2;v++)d[v]=Math.max(-255,45*Math.log10(p[v]));s.push(d),u+=e-l}t(s,this)}else this.fireEvent("error","Web Audio buffer is not available")}},{key:"loadFrequenciesData",value:function(t){var e=this,r=this.util.fetchFile({url:t});return r.on("success",(function(t){return e.drawSpectrogram(JSON.parse(t),e)})),r.on("error",(function(t){return e.fireEvent("error",t)})),r}},{key:"freqType",value:function(t){return t>=1e3?(t/1e3).toFixed(1):Math.round(t)}},{key:"unitType",value:function(t){return t>=1e3?"KHz":"Hz"}},{key:"loadLabels",value:function(t,e,r,n,a,i,o,s){t=t||"rgba(68,68,68,0)",e=e||"12px",r=r||"10px",n=n||"Helvetica",a=a||"#fff",i=i||"#fff",o=o||"center",s=s||"#specLabels";var l=this.height||512,h=l/256*5,c=(this.wavesurfer.backend.ac.sampleRate/2-0)/h,u=this.labelsEl.getContext("2d");this.labelsEl.height=this.height,this.labelsEl.width=55;var f,p=this.height/(this.wavesurfer.backend.ac.sampleRate/2);if(u)for(u.fillStyle=t,u.fillRect(0,0,55,l),u.fill(),f=0;f<=h;f++){u.textAlign=o,u.textBaseline="middle";var d=0+c*f,v=this.freqType(d),w=this.unitType(d),y=d*p;y=this.height-y-10,u.fillStyle=i,u.font=r+" "+n,u.fillText(w,40,y),u.fillStyle=a,u.font=e+" "+n,u.fillText(v,16,y)}}},{key:"updateScroll",value:function(t){this.wrapper&&(this.wrapper.scrollLeft=t.target.scrollLeft)}},{key:"resample",value:function(t){var e,r=this.width,n=[],a=1/t.length,i=1/r;for(e=0;e<r;e++){var o=new Array(t[0].length),s=void 0;for(s=0;s<t.length;s++){var l=s*a,h=l+a,c=e*i,u=c+i,f=h<=c||u<=l?0:Math.min(Math.max(h,c),Math.max(u,l))-Math.max(Math.min(h,c),Math.min(u,l)),p=void 0;if(f>0)for(p=0;p<t[0].length;p++)null==o[p]&&(o[p]=0),o[p]+=f/i*t[s][p]}var d=new Uint8Array(t[0].length),v=void 0;for(v=0;v<t[0].length;v++)d[v]=o[v];n.push(d)}return n}}])&&l(e.prototype,r),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.default=h,t.exports=e.default}},e={};var r=function r(n){var a=e[n];if(void 0!==a)return a.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}(943);return r})()));
//# sourceMappingURL=wavesurfer.spectrogram.min.js.map